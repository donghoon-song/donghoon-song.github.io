{"componentChunkName":"component---src-templates-blog-post-js","path":"/supabase/supabase-+-typescript-db-schema-연동하기/","result":{"data":{"site":{"siteMetadata":{"title":"사진찍는 웹 개발자의 블로그","author":"Donghoon Song","siteUrl":"https://donghoon-song.github.io","comment":{"utterances":"donghoon-song/hoon-blog-comments"},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"0147f1c5-d080-57cb-bc08-47aeea846028","excerpt":"이슈 supabase로 사이드 프로젝트를 하고 있다. Talk table에서 데이터를 가져오기 위해 interface를 선언했고 ref에 generic으로 넘겼다. 예시 코드는 vue3 + typescript 환경이다. supabase를 이용한 select 결과에서 data를 검사하면 string key와 any value를 가지는 일반적인 타입으로 추론되는 것을 확인할 수 있다.\nimage 그래서 Talk interface와 맞지 않기 때문에 타입 에러가 난다. image 설령 data type…","html":"<h2 id=\"이슈\" style=\"position:relative;\"><a href=\"#%EC%9D%B4%EC%8A%88\" aria-label=\"이슈 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>이슈</h2>\n<p>supabase로 사이드 프로젝트를 하고 있다. Talk table에서 데이터를 가져오기 위해 interface를 선언했고 ref에 generic으로 넘겼다.</p>\n<p>예시 코드는 vue3 + typescript 환경이다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Talk</span> <span class=\"token punctuation\">{</span>\n  id<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n  speaker_id<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  topic<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  created_at<span class=\"token operator\">:</span> <span class=\"token builtin\">string</span>\n  duration<span class=\"token operator\">:</span> <span class=\"token builtin\">number</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">const</span> talkList <span class=\"token operator\">=</span> <span class=\"token generic-function\"><span class=\"token function\">ref</span><span class=\"token generic class-name\"><span class=\"token operator\">&lt;</span>Talk<span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>supabase를 이용한 select 결과에서 data를 검사하면 string key와 any value를 가지는 일반적인 타입으로 추론되는 것을 확인할 수 있다.\n<img src=\"https://i.imgur.com/mL94ZOM.png\" alt=\"image\"></p>\n<p>그래서 Talk interface와 맞지 않기 때문에 타입 에러가 난다.</p>\n<p><img src=\"https://i.imgur.com/cRq3acO.png\" alt=\"image\"></p>\n<p>설령 data type을 단언한다 해도, DB schema가 변하면 다시 작성해야 한다.</p>\n<h2 id=\"해결\" style=\"position:relative;\"><a href=\"#%ED%95%B4%EA%B2%B0\" aria-label=\"해결 permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>해결</h2>\n<p>supabase-cli를 활용하면 DB schema를 추출해 supabase sdk와 연동할 수 있다.\n아래 링크를 보면 쉽게 따라갈 수 있다.\n<a href=\"https://supabase.com/docs/guides/api/rest/generating-types\">https://supabase.com/docs/guides/api/rest/generating-types</a></p>\n<p>PROJECT_REF를 찾는 게 처음에 어려웠는데, supabase dashboard를 들어간 후에 url에서 project 뒤에 오는 부분을 PROJECT_REF 칸에 넣어주면 된다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">https://supabase.com/dashboard/project/$PROJECT_REF</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx supabase gen types typescript --project-id <span class=\"token string\">\"<span class=\"token variable\">$PROJECT_REF</span>\"</span> --schema public <span class=\"token operator\">></span> src/types/supabase.ts</code></pre></div>\n<p>생성된 Database interface를 generic으로 넘긴다.\n<img src=\"https://i.imgur.com/rb7KkVs.png\" alt=\"image\"></p>\n<p>이렇게 적용하고 기존 코드를 다시 보면 data 타입이 바뀐 것을 볼 수 있다!\n<img src=\"https://i.imgur.com/BDmN0eY.png\" alt=\"image\"></p>\n<p>기존에 선언했던 Talk interface는 다음과 같이 Database interface에서 꺼내온 것으로 대체할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token comment\">// /types/talk.ts</span>\n<span class=\"token keyword\">import</span> <span class=\"token keyword\">type</span> <span class=\"token punctuation\">{</span> Database <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./supabase'</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">type</span> <span class=\"token class-name\">Talk</span> <span class=\"token operator\">=</span> Database<span class=\"token punctuation\">[</span><span class=\"token string\">'public'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Tables'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'talk'</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token string\">'Row'</span><span class=\"token punctuation\">]</span></code></pre></div>","frontmatter":{"title":"supabase + typescript DB schema 연동하기","date":"July 23, 2023"}}},"pageContext":{"slug":"/supabase/supabase-+-typescript-db-schema-연동하기/","previous":{"fields":{"slug":"/maker-log/회의실-예약-시스템을-내렸습니다./"},"frontmatter":{"title":"회의실 예약 시스템을 내렸습니다."}},"next":{"fields":{"slug":"/books/쉽게-시작하는-타입스크립트-책-리뷰/"},"frontmatter":{"title":"쉽게 시작하는 타입스크립트 책 리뷰"}}}},"staticQueryHashes":["2486386679","3128451518"],"slicesMap":{}}